VAGRANTFILE_API_VERSION = "2"

nodes = [
  { name: "lb",   ip: "192.168.56.5",   ports: [{guest:80, host:8083}, {guest:22, host:2223}] },
  { name: "web1", ip: "192.168.56.101", ports: [{guest:80, host:8084}, {guest:22, host:2224}] },
  { name: "web2", ip: "192.168.56.102", ports: [{guest:80, host:8086}, {guest:22, host:2225}] },
  { name: "db",   ip: "192.168.56.20",  ports: [{guest:22, host:2230}] }
]

nodes.each do |node|
  Vagrant.configure(VAGRANTFILE_API_VERSION) do |config|
    config.vm.define node[:name] do |vm|
      vm.vm.box = "ubuntu/jammy64"
      vm.vm.hostname = node[:name]

      # Set VM resources
      vm.vm.provider "virtualbox" do |vb|
        vb.memory = 1024
        vb.cpus   = 1
      end

      # Set network interfaces
      vm.vm.network "private_network", ip: node[:ip]

      # Forwarded ports
      node[:ports].each do |port|
        vm.vm.network "forwarded_port", guest: port[:guest], host: port[:host]
      end
    end
  end
end
